<html>
  <head>
    <style>
      * {
        box-sizing: border-box;
      }
      @keyframes psh__falling {
        0% {
          transform: translateY(-100px);
        }
        100% {
          transform: translateY(500px);
        }
      }
      .psh__falling {
        animation-name: psh__falling;
        animation-duration: 1400ms;
        animation-timing-function: linear;
        animation-delay: 0ms;
        animation-iteration-count: 1;
        animation-fill-mode: forwards;
      }
      .psh__frame {
        position: fixed;
        bottom: 0;
        right: 300px;
        z-index: 510;
      }
      .psh__guitar {

      }
      .psh__head {
        position: relative;
        width: 368px;
        z-index: 530;
      }
      .psh__head-hand {
        margin: 0 auto;
        height: 368px;
        width: 251px;
        background: url(hand.png) no-repeat center;
      }
      .psh__peg {
        position: absolute;
        height: 42px;
        width: 43px;
        background: url(peg.png) no-repeat center;
      }
      .psh__peg--nw {
        top: 125px;
        left: 0;
      }
      .psh__peg--sw {
        top: 205px;
        left: 0;
      }
      .psh__peg--ne {
        top: 125px;
        right: 0;
        transform: scaleX(-1);
      }
      .psh__peg--se {
        top: 205px;
        right: 0;
        transform: scaleX(-1);
      }
      .psh__neck {
        position: relative;
        overflow: hidden;
        width: 200px;
        height: 475px;
        margin: -100px auto 0 auto;
        background-color: #222222;
        z-index: 520;
      }
      .psh__frets {
        position: absolute;
        width: 100%;
        padding-top: 15px;
      }
      .psh__fret {
        width: 100%;
        margin-bottom: 87px;
        background-color: #EBEBEB;
        border-top: 2px solid #827E7D;
        border-bottom: 2px solid #827E7D;
      }
      .psh__strings {
        position: absolute;
        width: 100%;
        padding: 0 25px;
        font-size: 0;
      }
      .psh__string {
        display: inline-block;
        width: 5px;
        height: 475px;
        margin-right: 43px;
        background-color: #8E8C8C;
        border-left: 2px solid #9F9F9E;
        border-right: 2px solid #9F9F9E;
      }
      .psh__string:last-child {
        margin-right: 0;
      }
      .psh__lanes {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 475px;
        font-size: 0;
      }
      .psh__lane {
        display: inline-block;
        height: 475px;
        width: 50px;
        vertical-align: top;
        overflow: hidden;
      }
      .psh__token {
        height: 33px;
        width: 33px;
        border-radius: 50%;
        z-index: 540;

        /*transform: translateY(392px);*/
      }
      .psh__lane--1 {
        padding-left: 11px;
      }
      .psh__lane--2 {
        padding-left: 8px;
      }
      .psh__lane--3 {
        padding-left: 8px;
      }
      .psh__lane--4 {
        padding-left: 6px;
      }
      .psh__lane--1 .psh__token {
        background-color: #23B45D;
      }
      .psh__lane--2 .psh__token {
        background-color: #DC1F26;
      }
      .psh__lane--3 .psh__token {
        background-color: #F96816;
      }
      .psh__lane--4 .psh__token {
        background-color: #0C9DBF;
      }
      .psh__hitzone {
        position: absolute;
        bottom: 32px;
        left: 71px;
        height: 70px;
        width: 316px;
        overflow: hidden;
        background-color: rgba(255, 255, 255, .7);
        border-radius: 5px;
        border: 3px solid #F05A28;
        z-index: 530;
      }
      .psh__hitzone--hidden {
        display: none;
      }
      .psh__hitzone--hit {
        background-color: rgba(190, 254, 197, 0.7);
        border-color: #23B45D;
      }
      .psh__hitzone--miss {
        background-color: rgba(241, 196, 196, 0.7);
        border-color: #DC1F26;
      }
      .psh__hitkeys {
        position: absolute;
        top: 17px;
        left: 22px;
      }
      .psh__hitkey {
        height: 33px;
        width: 33px;
        margin-right: 11px;
        border-width: 3px;
        border-style: solid;
        text-align: center;
        line-height: 28px;
        border-radius: 50%;
        font-family: 'Gotham SSm A', 'Gotham SSm B', sans-serif;
        font-size: 12px;
        font-weight: bolder;
        display: inline-block;
        background-color: #D8D8D8;
      }
      .psh__hitkey--1 {
        border-color: #23B45D;
        color: #23B45D;
      }
      .psh__hitkey--2 {
        border-color: #DC1F26;
        color: #DC1F26;
      }
      .psh__hitkey--3 {
        border-color: #F96816;
        color: #F96816;
      }
      .psh__hitkey--4 {
        border-color: #0C9DBF;
        color: #0C9DBF;
      }
      .psh__hitkey--highlight {
        border-color: #d8d8d8;
        color: #d8d8d8;
      }
      .psh__hitkey--highlight--1 {
        background-color: #23be4d;
      }
      .psh__hitkey--highlight--2 {
        background-color: #DC1F26;
      }
      .psh__hitkey--highlight--3 {
        background-color: #F96816;
      }
      .psh__hitkey--highlight--4 {
        background-color: #0C9DBF;
      }
      .psh__score {
        position: absolute;
        top: 0;
        right: 0;
        height: 70px;
        width: 100px;
        text-align: center;
        background-color: #fff;
      }
      .psh__score__label {
        background-color: #F05A28;
        color: #fff;
        padding: 5px 0;
        font-family: 'Gotham SSm A', 'Gotham SSm B', sans-serif;
        font-weight: lighter;
        text-transform: uppercase;
        font-size: 12px;
      }
      .psh__score__nums {
        padding-top: 4px;
        font-size: 0;
      }
      .psh__score__num {
        display: inline-block;
        font-size: 30px;
        font-family: 'Gotham SSm A', 'Gotham SSm B', sans-serif;
        font-weight: lighter;
      }
      .psh__score__actual {
        color: #222222;
      }
      .psh__score__out-of {
        color: #ababab;
      }
      .psh__modal {
        position: absolute;
        left: 0;
        bottom: 70px;
        height: 274px;
        width: 365px;
        overflow: hidden;
        background-color: rgba(255, 255, 255, .9);
        border-radius: 5px;
        border: 3px solid #F05A28;
        padding: 24px;
        z-index: 530;
      }
      .psh__modal--hidden {
        display: none;
      }
      .psh__modal__copy {
        font-family: 'Gotham SSm A', 'Gotham SSm B', sans-serif;
        font-size: 14px;
        line-height: 1.2em;
        font-weight: 400;
        text-align: center;
        margin-bottom: 25px;
      }
    </style>
  </head>
  <body>

    <div class="psh__frame">
      <div class="psh__clock"></div>
      <div class="psh__sound"></div>
      <div class="psh__guitar">
        <div class="psh__head">
          <div class="psh__head-hand"></div>
          <div class="psh__peg psh__peg--nw"></div>
          <div class="psh__peg psh__peg--sw"></div>
          <div class="psh__peg psh__peg--ne"></div>
          <div class="psh__peg psh__peg--se"></div>
        </div>
        <div class="psh__neck">
          <div class="psh__frets">
            <div class="psh__fret"></div>
            <div class="psh__fret"></div>
            <div class="psh__fret"></div>
            <div class="psh__fret"></div>
            <div class="psh__fret"></div>
            <div class="psh__fret"></div>
          </div>
          <div class="psh__strings">
            <div class="psh__string"></div>
            <div class="psh__string"></div>
            <div class="psh__string"></div>
            <div class="psh__string"></div>
          </div>
          <div class="psh__lanes">
            <div class="psh__lane psh__lane--1"></div>
            <div class="psh__lane psh__lane--2"></div>
            <div class="psh__lane psh__lane--3"></div>
            <div class="psh__lane psh__lane--4"></div>
          </div>
        </div>
        <div class="psh__hitzone">
          <div class="psh__hitkeys">
            <div class="psh__hitkey psh__hitkey--1">A</div>
            <div class="psh__hitkey psh__hitkey--2">S</div>
            <div class="psh__hitkey psh__hitkey--3">D</div>
            <div class="psh__hitkey psh__hitkey--4">F</div>
          </div>
          <div class="psh__score">
            <div class="psh__score__label">Your Score</div>
            <div class="psh__score__nums">
              <div class="psh__score__num psh__score__actual">0</div>
              <div class="psh__score__num psh__score__out-of">/??</div>
            </div>
          </div>
        </div>
        <div class="psh__modal psh__modal--hidden">
          <div class="psh__modal__copy">You're about to get a backstage pass to Pluralsight. We're inviting an exclusive group of VIPs to participate in the development of new products and get an advanced look at new user experiences.</div>
          <script src="//app-sjqe.marketo.com/js/forms2/js/forms2.js"></script>
          <form id="mktoForm_1552"></form>
          <iframe id="marketo-file" style="display:none;"></iframe>
          <script>

              var formID = "1552";
              var url = "//app-sj11.marketo.com";
              var munchkinID = "306-DUP-745";

              if(typeof marketoIDs === "undefined") {
                  marketoIDs = {};
              }
              if(typeof marketoIDs[formID] === "undefined") {
                  marketoIDs[formID] = formID;
                  MktoForms2.loadForm(url, munchkinID, formID, function(form){
                      if (form) {
                          form.onSuccess(function (values, followUpUrl) {
                              jQuery(this.formElem).trigger("ps.formSuccess");
                              var redirectPath = "";
                              var downloadPath = "";
                              var successMessage = "\x3Ch3\x3EThank\x20you\x20for\x20subscribing\x3C\x2Fh3\x3E";
                              var formID = "1552";
                              //if file download
                              if (downloadPath) {
                                  var a = jQuery("<a>")
                                          .attr("href", downloadPath)
                                          .attr("download", "test-resource")
                                          .appendTo("body");
                                  a[0].click();
                                  a.remove();
                              }
                              // Take the lead to a different page on successful submit, ignoring the form's configured followUpUrl
                              if (redirectPath) {
                                  location.href = redirectPath;
                                  return false;
                              }
                              // replace the form with success message
                              if (successMessage) {
                                  this.formElem.replaceWith("<div class='marketo-form__success-message form-" + formID + "'>" + successMessage + "</div>");
                                  return false;
                              }
                          });

                          form.onValidate(function (isValid) {
                              if (isValid) {
                                  jQuery(this.formElem).trigger("ps.formValid");
                              } else {
                                  jQuery(this.formElem).trigger("ps.formInvalid");
                              }
                          });
                      }
                  });
                  MktoForms2.whenReady(function(form) {
                      jQuery(form.getFormElem()).trigger("ps.formRendered");
                  });
              }
          </script>
        </div>
      </div>
    </div>
  </body>

  <script>

    window.psHero = {
      start: function start() {
        function hasClass(el, className) {
          if (el.classList)
            return el.classList.contains(className)
          else
            return !!el.className.match(new RegExp('(\\s|^)' + className + '(\\s|$)'))
        }

        function addClass(el, className) {
          if (el.classList)
            el.classList.add(className)
          else if (!hasClass(el, className)) el.className += " " + className
        }

        function removeClass(el, className) {
          if (el.classList)
            el.classList.remove(className)
          else if (hasClass(el, className)) {
            var reg = new RegExp('(\\s|^)' + className + '(\\s|$)')
            el.className=el.className.replace(reg, ' ')
          }
        }

        function loadSound(sound, filePath, done) {
          sound.innerHTML = '<audio class="psh__audio">' +
              '<source src="' + filePath + '.mp3" type="audio/mpeg" />' +
              '<source src="' + filePath + '.ogg" type="audio/ogg" />' +
            '</audio>'
        }

        function createTimer() {
          var startTime = Date.now()
          return function timer() {
            return Date.now() - startTime
          }
        }

        function roundTimeTo(time, nearest) {
          return Math.round(time / nearest) * nearest
        }

        function roundTime(time) {
          return roundTimeTo(time, 500)
        }

        function isActionKey(KEYS, key) {
          return Object.keys(KEYS)
            .map(function (k) { return +k })
            .indexOf(key) > -1
        }

        function getLane(KEYS, key) {
          return KEYS[key]
        }

        function isInLane(targetLane, lane) {
          return targetLane === lane
        }

        function isInTime(targetTime, time) {
          return time <= targetTime + HIT_ALLOWANCE
              && time >= targetTime - HIT_ALLOWANCE
        }

        function isHit(song, lane, time) {
          return song.filter(function (note) {
            return isInTime(time, note.time) && isInLane(lane, note.lane)
          }).length > 0
        }

        function setScore(actual, outOf) {
          document.querySelector('.psh__score__actual').innerHTML = actual
          document.querySelector('.psh__score__out-of').innerHTML = '/' + outOf
        }

        function highlightLane(lane) {
          var btn = document.querySelector('.psh__hitkey--' + lane)
          addClass(btn, 'psh__hitkey--highlight')
          addClass(btn, 'psh__hitkey--highlight--' + lane)
          setTimeout(function () {
            removeClass(btn, 'psh__hitkey--highlight')
            removeClass(btn, 'psh__hitkey--highlight--' + lane)
          }, TIME_TO_KEY_FEEDBACK)
        }

        function detectHit(getTime, evt) {
          var key = evt.which
          if (isActionKey(KEYS, key)) {
            highlightLane(getLane(KEYS, key))

            if (isHit(song, getLane(KEYS, key), getTime())) {
              setScore(score++, song.length)
              addClass(hitzone, 'psh__hitzone--hit')
              setTimeout(function () { removeClass(hitzone, 'psh__hitzone--hit') }, TIME_TO_HIT_FEEDBACK)
            } else {
              addClass(hitzone, 'psh__hitzone--miss')
              setTimeout(function () { removeClass(hitzone, 'psh__hitzone--miss') }, TIME_TO_HIT_FEEDBACK)
            }
          }
        }

        function isTimeToDrop(targetTime, time) {
          return (TIME_TO_HITZONE + roundTimeTo(targetTime, 100)) === time
        }

        function dropNote(note) {
          var el = document.createElement('div')
          el.className = 'psh__token psh__falling'

          var lane = document.querySelector('.psh__lane--' + note.lane)
          lane.appendChild(el)
          setTimeout(function () { lane.removeChild(el) }, TIME_TO_DISAPPEAR)
        }

        function dropNotes(getTime, evt) {
          song.forEach(function (note) {
            if (isTimeToDrop(getTime(), note.time)) {
              dropNote(note)
            }
          })
        }

        function endGame() {
          removeClass(modal, 'psh__modal--hidden')
          addClass(hitzone, 'psh__hitzone--hidden')
        }

        var HIT_ALLOWANCE = 300
        var TIME_TO_KEY_FEEDBACK = 300
        var TIME_TO_HIT_FEEDBACK = 400
        var TIME_TO_HITZONE = 1000
        var TIME_TO_DISAPPEAR = 1500
        var SONG_TIME = 25000
        var SOUND_FILE_PATH = 'song'
        var KEYS = {
          65: 1, // A
          83: 2, // S
          68: 3, // D
          70: 4  // F
        }

        var song = [
          { lane: 1, time: 1800 },
          { lane: 2, time: 2700 },
          { lane: 3, time: 3600 },
          { lane: 4, time: 4500 },
          { lane: 1, time: 5500 },
          { lane: 2, time: 6400 },
          { lane: 3, time: 7300 },
          { lane: 4, time: 8200 },
          { lane: 1, time: 9100 },
          { lane: 3, time: 10000 },
          { lane: 2, time: 11000 },
          { lane: 4, time: 11900 },
          { lane: 1, time: 12800 },
          { lane: 3, time: 13700 },
          { lane: 2, time: 14700 },
          { lane: 4, time: 15500 },
          { lane: 1, time: 16500 },
          { lane: 2, time: 17400 },
          { lane: 3, time: 18300 },
          { lane: 4, time: 19200 },
          { lane: 1, time: 20100 },
          { lane: 2, time: 21000 },
          { lane: 3, time: 21900 },
          { lane: 4, time: 22900 }
        ]
        var score = 0
        var sound = document.querySelector('.psh__sound')
        var hitzone = document.querySelector('.psh__hitzone')
        var modal = document.querySelector('.psh__modal')

        loadSound(sound, SOUND_FILE_PATH)

        var audio = document.querySelector('.psh__audio')
        audio.addEventListener('canplaythrough', function () {
          var getTime = createTimer()
          document.addEventListener('keydown', detectHit.bind(this, getTime))
          audio.play()
          setInterval(dropNotes.bind(this, getTime), 100)
          setScore(score, song.length)

          setTimeout(endGame, SONG_TIME)
        })
      }
    }

    psHero.start()

  </script>
</html>
